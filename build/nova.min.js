function ITER$0(e,n){if(e){if(Array.isArray(e))return n?e.slice():e;var r,o;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(n=e[S_ITER$0])?(r=n.call(e),o=[]):e+""=="[object Generator]"&&(r=e,o=[]),S_MARK$0&&S_MARK$0(void 0),o){for(;n=r.next(),n.done!==!0;)o.push(n.value);return o}}throw new Error(e+" is not iterable")}function GET_ITER$0(e){if(e){if(Array.isArray(e))return 0;var n;if(S_MARK$0&&S_MARK$0(e),"object"==typeof e&&"function"==typeof(n=e[S_ITER$0]))return S_MARK$0&&S_MARK$0(void 0),n.call(e);if(S_MARK$0&&S_MARK$0(void 0),e+""=="[object Generator]")return e}throw new Error(e+" is not iterable")}var S_ITER$0="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",S_MARK$0="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__,nova={shared:{higherOrder:{},math:{},signal:{}},components:{shapes:{},bodies:{},appearances:{},misc:{}},core:{engine:{},update:{},render:{},state:{}},utils:{input:{},assets:{},misc:{}}};!function(){var e=nova.shared.higherOrder,n=function(e){return e};e.id=n;var r=function(e){return function(n){return e}};e.constant=r;var o=function(e,n){return function(r){return e(n(r))}};e.compose=o;var t=function(e){return e.reduce(o,n)};e.chain=t;var a=function(e,n){return function(r){var o=Array.prototype.slice,t=o.call(arguments,1);return e.apply(null,[n.apply(null,[r].concat(ITER$0(t)))].concat(ITER$0(t)))}};e.composeP1=a;var i=function(e){return e.reduce(a,n)};e.chainP1=i}(),function(){var e=nova.shared.math,n=6.283185307179586;e.TAU=n;var r=n/2;e.PI=r;var o=function(e){return e/n*360};e.degrees=o;var t=function(e){return e/360*n};e.radians=t;var a=function(){var e=Math.floor(i(0,256)),n=Math.floor(i(0,256)),r=Math.floor(i(0,256));return"rgb("+e+", "+n+", "+r+")"};e.randomRGB=a;var i=function(e,n){return Math.random()*(n-e)+e};e.randomBetween=i;var u=function(e){return e[Math.floor(Math.random()*e.length)]};e.choose=u;var v=function(e,n){return Math.floor(e/n)*n};e.snap=v;var s=function(e,n,r){return e<n?n:e>r?r:e};e.clamp=s;var c=Object.freeze({GT:1,EQ:0,LT:-1});e.ORD=c;var d=function(e,n){return e>n?c.GT:e<n?c.LT:c.EQ};e.compare=d;var l=function(e){for(var n=[],r=0,o=e.length;r<o;r+=1)for(var t=e[r],a=r+1;a<o;a+=1){var i=e[a];n.push([t,i])}return n};e.combinations=l;var f=function(e,n){for(var r=[],o=0,t=e.length;o<t;o+=1)for(var a=e[o],i=0,u=n.length;i<u;i+=1){var v=n[i];r.push([a,v])}return r};e.combinationsBetween=f;var p=function(){var e=arguments[0];void 0===e&&(e=0);var n=arguments[1];return void 0===n&&(n=0),{x:e,y:n}};p.add=function(e,n){var r=e.x,e=e.y,o=n.x,n=n.y;return p(r+o,e+n)},p.sub=function(e,n){var r=e.x,e=e.y,o=n.x,n=n.y;return p(r-o,e-n)},p.mul=function(e,n){var r=e.x,e=e.y;return p(r*n,e*n)},p.div=function(e,n){var r=e.x,e=e.y;return p(r/n,e/n)},p.negate=function(e){var n=e.x,e=e.y;return p(-n,-e)},p.magnitude=function(e){var n=e.x,e=e.y;return Math.sqrt(n*n+e*e)},p.squareMagnitude=function(e){var n=e.x,e=e.y;return n*n+e*e},p.normal=function(e){return p.div(e,p.magnitude(e))},p.area=function(e){var n=e.x,e=e.y;return n*e},p.dot=function(e,n){var r=e.x,e=e.y,o=n.x,n=n.y;return r*o+e*n},p.rotate=function(e,n){var r=e.x,e=e.y,o=Math.cos(n),t=Math.sin(n);return p(r*o-e*t,r*t+e*o)},p.clone=function(e){var n=e.x,e=e.y;return p(n,e)},p.polar=function(e,n){return p(Math.cos(e)*n,Math.sin(e)*n)},p.ZERO=p(0,0),e.V=p}(),function(){var e=nova.shared.signal,n=function(e){setTimeout(e,0)},r=function(){var e={};return e.listeners=[],e.queue=[],e.isOpen=!0,e.open=function(){return r.open(e)},e.close=function(){return r.close(e)},e.read=function(n){return r.read(n,e)},e.write=function(n){return r.write(n,e)},e.flush=function(){return r.flush(e)},e.pipe=function(n){return r.pipe(e,n)},e.map=function(n){return r.map(n,e)},e.filter=function(n){return r.filter(n,e)},e.flatten=function(){return r.flatten(e)},e.flatMap=function(n){return r.flatMap(n,e)},e.foldp=function(n,o){return r.foldp(n,o,e)},e};r.open=function(e){return e.isOpen=!0,r.flush(e),e},r.close=function(e){return e.isOpen=!1,e},r.read=function(e,n){return n.listeners.push(e),n},r.write=function(e,n){return n.queue.push(e),r.flush(n),n},r.flush=function(e){var n,r,o,t,a,i,u,v;if(e.isOpen){t=e.queue,n=GET_ITER$0(t),o=0===n,r=o?t.length:void 0;for(var s;o?n<r:!(r=n.next()).done;){s=o?t[n++]:r.value,v=e.listeners,a=GET_ITER$0(v),u=0===a,i=u?v.length:void 0;for(var c;u?a<i:!(i=a.next()).done;)(c=u?v[a++]:i.value)(s);a=i=u=v=void 0}n=r=o=t=void 0,e.queue.length=0}return e},r.pipe=function(e,n){return r.read(function(e){return r.write(e,n)},e),n},r.map=function(e,n){var o=r();return r.read(function(n){return r.write(e(n),o)},n),o},r.filter=function(e,n){var o=r();return r.read(function(n){return e(n)?r.write(n,o):void 0},n),o},r.flatten=function(e){var n=r();return r.read(function(e){return r.pipe(e,n)},e),n},r.flatMap=function(e,n){return r.flatten(r.map(e,n))},r.foldp=function(e,n,o){var t=r(),a=n;return r.read(function(n){a=e(a,n),r.write(a,t)},o),t},r.fromArray=function(e){var o=r();return n(function(){var n,r,t;n=GET_ITER$0(e),t=0===n,r=t?e.length:void 0;for(var a;t?n<r:!(r=n.next()).done;)a=t?e[n++]:r.value,o.write(a);n=r=t=void 0}),o},r.interval=function(e){var n=r(),o=0;return setInterval(function(){r.write(o,n),o+=1},e),n},r.timeout=function(e){var n=r();return setTimeout(function(){r.write(0,n)},e),n},e.S=r}(),function(){var e=nova.components.shapes,n=nova.shared.math.V,r=Object.freeze({BOX:Symbol("Box"),CIRCLE:Symbol("Circle"),INFINITE:Symbol("Infinite"),REPEATING:Symbol("Repeating")});e.SHAPES=r;var o=function(e,o,t,a){return function(){var i=arguments[0];void 0===i&&(i={}),i.shape=r.BOX,i.pos=n(e,o),i.size=n(t,a)}};e.Box=o;var t=function(e,o,t){return function(){var a=arguments[0];return void 0===a&&(a={}),a.shape=r.CIRCLE,a.pos=n(e,o),a.radius=t,a}};e.Circle=t;var a=function(){var e=arguments[0];return void 0===e&&(e={}),e.shape=r.INFINITE,e};e.Infinite=a;var i=function(e,o,t,a){return function(){var i=arguments[0];return void 0===i&&(i={}),i.shape=r.REPEATING,i.pos=n(e,o),i.size=n(t,a),i}};e.Repeating=i}(),function(){var e=nova.components.bodies,n=nova.shared.math.V,r=Object.freeze({DYNAMIC:Symbol("Dynamic"),IMMOVABLE:Symbol("Immovable"),MOVABLE:Symbol("Movable")});e.BODIES=r;var o=function(e){return e.body===r.DYNAMIC||e.body===r.MOVABLE};e.canMove=o;var t=function(e){return e.body===r.DYNAMIC||e.body===r.IMMOVABLE};e.canCollide=t;var a=function(){var e=arguments[0];void 0===e&&(e=1);var o=arguments[1];return void 0===o&&(o=0),function(){var t=arguments[0];return void 0===t&&(t={}),t.body=r.DYNAMIC,t.mass=e,t.restitution=o,t.vel=n.ZERO,t.acc=n.ZERO,t.lastAcc=n.ZERO,t}};e.Dynamic=a;var i=function(){var e=arguments[0];return void 0===e&&(e=0),function(){var n=arguments[0];void 0===n&&(n={}),n.body=r.IMMOVABLE,n.mass=1/0,n.restitution=e}};e.Immovable=i;var u=function(){var e=arguments[0];return void 0===e&&(e=1),function(){var o=arguments[0];return void 0===o&&(o={}),o.body=r.MOVABLE,o.mass=e,o.vel=n.ZERO,o.acc=n.ZERO,o.lastAcc=n.ZERO,o}};e.Movable=u}(),function(){var e=nova.components.appearances,n=((n=nova.shared.higherOrder).constant,n.composeP1),r=nova.shared.math.V,o=Object.freeze({COLOR:Symbol("Color"),PICTURE:Symbol("Picture"),SPRITE:Symbol("Sprite"),CUSTOM:Symbol("Custom")});e.APPEARANCES=o;var t=function(e){return void 0!==e.appearance};e.hasAppearance=t;var a=function(e){var n=arguments[1];void 0===n&&(n=0);var r=arguments[2];return void 0===r&&(r=0),function(){var t=arguments[0];return void 0===t&&(t={}),t.appearance=o.COLOR,t.color=e,t.depth=n,t.layer=r,t}};e.Color=a;var i=function(e){var n=arguments[1];void 0===n&&(n=0);var r=arguments[2];return void 0===r&&(r=0),function(){var t=arguments[0];return void 0===t&&(t={}),t.appearance=o.PICTURE,t.image=e,t.depth=n,t.layer=r,t}};e.Picture=i;var u=function(e,n){var t=arguments[2];void 0===t&&(t=0);var a=arguments[3];return void 0===a&&(a=0),function(){var i=arguments[0];return void 0===i&&(i={}),i.appearance=o.SPRITE,i.image=e,i.animation=n,i.depth=t,i.layer=a,i.clipPos=r(0,0),i.clipSize=r(e.width,e.height),i.setAnimation=function(e){return i.animation=e,i.frame%=i.animation.length,i.determineClipPos(),i},i.animate=function(e){return i.animation.length>0&&(i.frame+=e,i.frame%=i.animation.length,i.determineClipPos()),i},i.resetAnimation=function(){return i.animation.length>0&&(i.frame=0,i.determineClipPos()),i},i.determineClipPos=function(){var e=i.animation[Math.floor(i.frame)];i.clipPos.x=e[0],i.clipPos.y=e[1]},i.buildAnimation=function(){var e=arguments[0];void 0===e&&(e=0);var n=arguments[1];void 0===n&&(n=0);var r=arguments[2];void 0===r&&(r=0);var o=arguments[3];void 0===o&&(o=0);for(var t=[],a=Math.ceil((i.image.width+r)/(i.size.x+r)),u=e;u<n;u++)t.push([(i.size.x+r)*(u%a),(i.size.y+o)*Math.floor(u/a)]);return t},i}};e.Sprite=u;var v=function(e){return function(){var r=arguments[0];void 0===r&&(r={}),r.appearance=o.CUSTOM;var t=e(r);return r.render=void 0===r.render?t:n(t,r.render),r}};e.Custom=v}(),function(){var e=nova.components.misc,n=nova.shared.higherOrder.composeP1,r=nova.shared.math.randomBetween,o=(t=nova.components.shapes).Box,t=t.Circle,a=function(){var e=arguments[0];void 0===e&&(e={}),e.isObservable=!0;var n={};e.on=function(r,o){return void 0===n[r]&&(n[r]=[]),n[r].push(o),e},e.trigger=function(r,o){var t,a,i,u;if(void 0!==n[r]){u=n[r],t=GET_ITER$0(u),i=0===t,a=i?u.length:void 0;for(var v;i?t<a:!(a=t.next()).done;)v=i?u[t++]:a.value,v.apply(null,ITER$0(o));t=a=i=u=void 0}return void 0!==e[r]&&e[r].apply(e,ITER$0(o)),e}};e.Observable=a;var i=function(e){return function(){var n=arguments[0];return void 0===n&&(n={}),n.name=e,n}};e.Name=i;var u=function(e,n,r,o){return function(){var o=arguments[0];return void 0===o&&(o={}),o.update=function(t){return n.pressed(e.left)&&(o.pos.x-=r*t),n.pressed(e.up)&&(o.pos.y-=r*t),n.pressed(e.right)&&(o.pos.x+=r*t),n.pressed(e.down)&&(o.pos.y+=r*t),o},o}};e.Fourway=u;var v=function(e,n,r){return u({left:37,up:38,right:39,down:40},e,n,r)};e.Arrows=v;var s=function(e,n,r){return u({left:65,up:87,right:68,down:83},e,n,r)};e.WASD=s;var c=function(e,n,t,a){var i=r(0,t-e),u=r(0,a-n);return o(i,u,e,n)};e.RandomBox=c;var d=function(e,n,o){var a=r(e,n-e),i=r(e,o-e);return t(a,i,e)};e.RandomCircle=d;var l=function(e){return function(){var r=arguments[0];void 0===r&&(r={});var o=e(r);return r.update=void 0===r.update?o:n(o,r.update),r}};e.Update=l}(),function(){var e=nova.core.engine,n=nova.shared.signal.S,r=function(){var e=n(),r=function(o){requestAnimationFrame(function(){var t=window.performance.now(),a=(t-o)/1e3;n.write(a,e),r(t)})};return r(window.performance.now()),e};e.Engine=r}(),function(){var e=nova.core.state,n=nova.shared.math.V,r=function(e,r){var o=arguments[2];void 0===o&&(o=0);var t={};return t.pos=n(e,r),t.depth=o,t};e.Camera=r;var o=function(e,n){var r={};return r.camera=e,r.bounds=n,r.entities=[],r.clear=function(){var e,n,o,t;t=r.entities,e=GET_ITER$0(t),o=0===e,n=o?t.length:void 0;for(var a;o?e<n:!(n=e.next()).done;)a=o?t[e++]:n.value,a.isObservable&&a.trigger("remove");return e=n=o=t=void 0,r.entities=[],r},r.add=function(e){return r.entities.push(e),e.isObservable&&e.trigger("add"),r},r.solo=function(e){return r.clear(),r.add(e),r},r};e.State=o}(),function(){var e=nova.core.update,n=nova.components.shapes.SHAPES,r=(o=nova.components.bodies).BODIES,o=o.canMove,t=(i=nova.shared.math).V,a=i.combinations,i=i.combinationsBetween,u=function(e){var n=arguments[1];void 0===n&&(n=1/60);var r=arguments[2];void 0===r&&(r=1/15);var o=0;return function(t,a){o+=Math.min(a,r);for(var i=t;o>=n;)o-=n,i=e(i,n);return i}};e.cruiseControl=u;var v=function(e){var n=e.integrate,o=e.collisionPairs,t=e.collision,a=e.resolve,e=e.update;return function(i,u){var v,s,c,d,l=[];d=i.entities,v=GET_ITER$0(d),c=0===v,s=c?d.length:void 0;for(var f;c?v<s:!(s=v.next()).done;)f=c?d[v++]:s.value,f.body!==r.DYNAMIC&&f.body!==r.MOVABLE||n(f,u),f.body!==r.DYNAMIC&&f.body!==r.IMMOVABLE||l.push(f);v=s=c=d=void 0;var p=o(l),m=void 0,h=void 0;for(v=GET_ITER$0(p),c=0===v,s=c?p.length:void 0;c?v<s:!(s=v.next()).done;){m=(h=c?p[v++]:s.value)[0],h=h[1];var E=t(m,h);null!==E&&a(E,m,h)}v=s=c=void 0,m=void 0,h=void 0,c=i.entities,d=GET_ITER$0(c),s=0===d,v=s?c.length:void 0;for(var y;s?d<v:!(v=d.next()).done;)y=s?c[d++]:v.value,e(y,u);return d=v=s=c=void 0,i}};e.updater=v;var s=function(e,n){return e.pos=t.add(e.pos,t.mul(t.add(e.vel,t.mul(e.lastAcc,n/2)),n)),e.vel=t.add(e.vel,t.mul(t.add(e.lastAcc,e.acc),n/2)),e.lastAcc=t.clone(e.acc),e};e.verletIntegrator=s;var c=function(e){var n,o,t,u=[],v=[];n=GET_ITER$0(e),t=0===n,o=t?e.length:void 0;for(var s;t?n<o:!(o=n.next()).done;)s=t?e[n++]:o.value,s.body===r.DYNAMIC?u.push(s):s.body===r.IMMOVABLE&&v.push(s);n=o=t=void 0;var c=a(u),d=i(u,v),l=c.concat(d);return l};e.bruteforcePairs=c;var d=function(e,n,r,o){var a=arguments[4];void 0===a&&(a=1);var i={};i.pos=t(e,n),i.size=t(r,o),i.trees=[],i.movableBodies=[],i.immovableBodies=[];var u=10,v=10,s=function(e){var n,r,o,t,a=(u=(v=e).pos).x1,u=u.y1,v=(e=v.size).x,e=e.y;t=i.trees,n=GET_ITER$0(t),o=0===n,r=o?t.length:void 0;for(var s;o?n<r:!(r=n.next()).done;){s=o?t[n++]:r.value;var c=(d=s.pos).x2,d=d.y2,l=(f=s.size).x,f=f.y;if(a>c&&a+v<c+l&&u>d&&u+e<d+f)return s}return n=r=o=t=void 0,null},c=function(){var e,n,r,o=i.size.over(2),t=o.x,u=o.y,v=(s=i.pos.plus(o)).x,s=s.y,c=(l=i.pos).x,l=l.y,f=d(c,l,t,u,a+1),p=d(v,l,t,u,a+1),m=d(c,s,t,u,a+1),h=d(v,s,t,u,a+1);i.trees.push(f,p,m,h);var E=i.bodies;i.bodies=[],e=GET_ITER$0(E),r=0===e,n=r?E.length:void 0;for(var y;r?e<n:!(n=e.next()).done;)y=r?E[e++]:n.value,i.add(y);e=n=r=void 0;var b=i.immovableBodies;i.immovableBodies=[],e=GET_ITER$0(b),r=0===e,n=r?b.length:void 0;for(var g;r?e<n:!(n=e.next()).done;)g=r?b[e++]:n.value,i.add(g);return e=n=r=void 0,i};return i.add=function(e){var n=s(e);return null!==n?n.add(e):(e.immovable?i.immovableBodies.push(e):i.movableBodies.push(e),i.movableBodies.length+i.immovableBodies.length>u&&a<v&&c()),i},i.pairs=function(e){var n,r,o,t,a=arguments[1];void 0===a&&(a=[]),a.push.apply(a,ITER$0(i.movableBodies)),e.immovable||a.push.apply(a,ITER$0(i.immovableBodies));var u=s(e);if(null!==u)u.pairs(e,a);else{t=i.trees,n=GET_ITER$0(t),o=0===n,r=o?t.length:void 0;for(var v;o?n<r:!(r=n.next()).done;)v=o?t[n++]:r.value,v.pairs(e,a);n=r=o=t=void 0}return i},i},l=function(e){var n,r,o,t=1/0,a=1/0,i=-(1/0),u=-(1/0),v=1/0,s=1/0,c=-(1/0),l=-(1/0);n=GET_ITER$0(e),o=0===n,r=o?e.length:void 0;for(var f;o?n<r:!(r=n.next()).done;)f=o?e[n++]:r.value,f.pos.x<t?(a=t,t=f.pos.x):f.pos.x<a&&(a=f.pos.x),f.pos.x+f.size.x>i?(u=i,i=f.pos.x+f.size.x):f.pos.x+f.size.x>u&&(u=f.pos.x+f.size.x),f.pos.y<v?(s=v,v=f.pos.y):f.pos.y<s&&(s=f.pos.y),f.pos.y+f.size.y>c?(l=c,c=f.pos.y+f.size.y):f.pos.y+f.size.y>l&&(l=f.pos.y+f.size.y);n=r=o=void 0;var p=d(a,s,u-a,l-s);n=GET_ITER$0(e),o=0===n,r=o?e.length:void 0;for(var m;o?n<r:!(r=n.next()).done;)m=o?e[n++]:r.value,p.add(m);return n=r=o=void 0,p.pairs()};e.quadtreePairs=l;var f=function(e,r){if(e.shape===n.BOX&&r.shape===n.BOX){if(e.pos.x<r.pos.x+r.size.x&&e.pos.x+e.size.x>r.pos.x&&e.pos.y<r.pos.y+r.size.y&&e.pos.y+e.size.y>r.pos.y){var o=t.sub(t.add(e.pos,e.size),r.pos),a=t.sub(e.pos,t.add(r.pos,r.size)),i=Math.abs(o.x)<Math.abs(a.x)?o.x:a.x,u=Math.abs(o.y)<Math.abs(a.y)?o.y:a.y,v=Math.abs(i)>=Math.abs(u)?t(i,0):t(0,u);return v}return null}if(e.shape===n.CIRCLE&&r.shape===n.CIRCLE){var s=t.sub(r.pos,e.pos),c=t.squareMagnitude(s),d=e.radius+r.radius;if(c<d*d){var l=Math.sqrt(c),p=t.mul(s,(d-l)/l);return p}return null}if(e.shape===n.CIRCLE&&r.shape===n.BOX)return null;if(e.shape===n.CIRCLE&&r.shape===n.BOX){var m=f(r,e);return null===m?null:t.negate(m)}};e.getCollision=f;var p=Object.freeze({RESOLVE:Symbol("Resolve"),IGNORE:Symbol("Ignore")});e.COLLISION_RESPONSE=p;var m=function(e,n){return function(r,o,a){var i=void 0!==o.resolve?o.resolve(r,o):p.RESOLVE,u=void 0!==a.resolve?a.resolve(r,a):p.RESOLVE;if(i===p.RESOLVE&&u===p.RESOLVE){var v=t.magnitude(r),s=t.div(r,v),c=t.dot(t.sub(a.vel,o.vel),s);if(c<=0){var d=1/o.mass,l=1/a.mass,f=-(1+Math.min(o.restitution,a.restitution))*c/(d+l),m=t.mul(s,f);o.vel=t.sub(o.vel,t.mul(m,d)),a.vel=t.add(a.vel,t.mul(m,l));var h=t.mul(s,Math.max(v-n,0)/(d+l)*e);o.pos=t.sub(o.pos,t.mul(h,d)),a.pos=t.add(a.pos,t.mul(h,l))}}}};e.impulseResolver=m;var h=function(e,n,r){n.pos=t.sub(n.pos,e),n.vel.x*e.x>0&&(n.vel.x=r.vel.x),n.vel.y*e.y>0&&(n.vel.y=r.vel.y)};e.positionalResolver=h;var E=function(e,n){return void 0!==e.update?e.update(n):e};e.updateChild=E;var y=v({integrate:s,collisionPairs:c,collision:f,resolve:m(.7,0),update:E});e.defaultUpdate=y;var b=function(e){var n=function(n,r){var o=t.sub(n.pos,r.pos),a=t.magnitude(o),i=n.mass,u=r.mass,v=e*i*u/(a*a);return t.mul(t.normal(o),v)};return function(e,r){var i,u,v,s,c=e.entities.filter(o);i=GET_ITER$0(c),v=0===i,u=v?c.length:void 0;for(var d;v?i<u:!(u=i.next()).done;)d=v?c[i++]:u.value,d.acc=t.ZERO;i=u=v=void 0;var l=void 0,f=void 0;for(s=a(c),i=GET_ITER$0(s),v=0===i,u=v?s.length:void 0;v?i<u:!(u=i.next()).done;){l=(f=v?s[i++]:u.value)[0],f=f[1];var p=n(l,f),m=t.negate(p);l.acc=t.add(l.acc,t.div(m,l.mass)),f.acc=t.add(f.acc,t.div(p,f.mass))}return i=u=v=s=void 0,l=void 0,f=void 0,e}};e.applyGravity=b}(),function(){var e=nova.core.render,n=nova.components.shapes.SHAPES,r=(o=nova.components.appearances).APPEARANCES,o=o.hasAppearance,t=nova.shared.math.V,a=function(e,o,t){if(t.shape===n.INFINITE)return!0;if(t.shape===n.REPEATING)return!0;if(t.shape===n.BOX){var a=(i=t.pos).x,i=i.y,u=(v=t.size).x,v=v.y,s=(c=o.pos).x,c=c.y,d=(l=[e.canvas.width,e.canvas.height])[0],l=l[1];return a+u-s>0&&i+v-c>0&&a-s<d&&i-c<l}if(t.shape===n.CIRCLE){var f=(p=t.pos).x,p=p.y,m=t.radius,h=(E=o.pos).x,E=E.y,y=(b=[e.canvas.width,e.canvas.height])[0],b=b[1];return f+m-h>0&&p+m-E>0&&f-m-h<y&&p-m-E<b}return t.appearance===r.CUSTOM},i=function(e,o,a){if(a.appearance===r.COLOR){if(a.shape===n.BOX){var i=(u=t.sub(a.pos,o.pos)).x,u=u.y,v=(s=a.size).x,s=s.y;e.fillStyle=a.color,e.fillRect(i,u,v,s)}else if(a.shape===n.CIRCLE){var c=(d=t.sub(a.pos,o.pos)).x,d=d.y,l=a.radius;e.fillStyle=a.color,e.beginPath(),e.arc(c,d,l,0,2*Math.PI),e.fill()}else if(a.shape===n.INFINITE){var f=(p=[e.canvas.width,e.canvas.height])[0],p=p[1];e.fillStyle=a.color,e.fillRect(0,0,f,p)}}else if(a.appearance===r.PICTURE){if(a.shape===n.BOX){var m=(h=t.sub(a.pos,o.pos)).x,h=h.y;e.drawImage(a.image,m,h,a.size.x,a.size.y)}else if(a.shape===n.REPEATING)var E=((E=t.sub(a.pos,o.pos)).x,E.y),y=((y=a.size).x,y.y),b=((b=[e.canvas.width,e.canvas.height])[0],b[1])}else if(a.appearance===r.SPRITE&&a.shape===n.BOX){var g=(x=t.sub(a.pos,o.pos)).x,x=x.y;e.drawImage(a.image,a.clipPos.x,a.clipPos.y,a.clipSize.x,a.clipSize.y,g,x,a.size.x,a.size.y)}},u=function(e){var n=e.getContext("2d");return function(r,t){var u,v,s,c,d=[];c=r.entities,u=GET_ITER$0(c),s=0===u,v=s?c.length:void 0;for(var l;s?u<v:!(v=u.next()).done;)l=s?c[u++]:v.value,o(l)&&a(n,r.camera,l)&&d.push(l);u=v=s=c=void 0;var f=d.sort(function(e,n){return n.depth-e.depth||n.layer-e.layer});n.clearRect(0,0,e.width,e.height),u=GET_ITER$0(f),s=0===u,v=s?f.length:void 0;for(var p;s?u<v:!(v=u.next()).done;)p=s?f[u++]:v.value,i(n,r.camera,p);u=v=s=void 0,s=r.entities,c=GET_ITER$0(s),v=0===c,u=v?s.length:void 0;for(var m;v?c<u:!(u=c.next()).done;)m=v?s[c++]:u.value,void 0!==m.render&&m.render(n,r.camera);c=u=v=s=void 0}};e.renderer=u}(),function(){var e=nova.utils.input,n=nova.shared.math.V,r=function(e){var n=e.getBoundingClientRect(),r=document.body,o=document.documentElement,t=window.pageYOffset||o.scrollTop||r.scrollTop,a=window.pageXOffset||o.scrollLeft||r.scrollLeft,i=o.clientTop||r.clientTop||0,u=o.clientLeft||r.clientLeft||0,v=n.top+t-i,s=n.left+a-u;return{x:Math.round(s),y:Math.round(v)}},o=Object.freeze({CLICKED:Symbol("Clicked"),CANCELLED:Symbol("Cancelled"),UNCLICKED:Symbol("Unclicked")}),t=function(e){var t={},a=o.UNCLICKED;return t.pos=n(0,0),t.clicked=function(){return a===o.CLICKED},t.cancel=function(){return a===o.CLICKED&&(a=o.CANCELLED),t},e.addEventListener("mousedown",function(){a!==o.CANCELLED&&(a=o.CLICKED)},!1),e.addEventListener("mouseup",function(){a=o.UNCLICKED},!1),e.addEventListener("mousemove",function(n){var o=r(e);t.pos.x=n.clientX-o.x,t.pos.y=n.clientY-o.y},!1),t};e.Mouse=t;var a=Object.freeze({LEFT:37,UP:38,RIGHT:39,DOWN:40});e.KEYS=a;var i=Object.freeze({PRESSED:Symbol("Pressed"),CANCELLED:Symbol("Cancelled"),UNPRESSED:Symbol("Unpressed")}),u=function(){var e={},n={};return window.addEventListener("keydown",function(e){n[e.keyCode]!==i.CANCELLED&&(n[e.keyCode]=i.PRESSED)},!1),window.addEventListener("keyup",function(e){n[e.keyCode]=i.UNPRESSED},!1),e.pressed=function(e){return n[e]===i.PRESSED},e.cancel=function(r){return n[r]===i.PRESSED&&(n[r]=i.CANCELLED),e},e};e.Keyboard=u}(),function(){var e=nova.utils.assets,n=function(e){return new Promise(function(n,r){var o=new Image;o.onload=function(){n(o)},o.src=e})};e.loadImage=n;var r=function(e){return new Promise(function(n,r){var o=new Audio;o.oncanplay=function(){n(o)},o.src=e})};e.loadAudioMedia=r;var o=function(){return void 0===o.singleton&&(o.singleton=void 0!==window.AudioContext?new window.AudioContext:void 0!==window.WebkitAudioContext?new window.WebkitAudioContext:null),o.singleton},t=function(e){if(null!==o())return new Promise(function(n,r){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){o().decodeAudioData(t.response,function(o){return o?void n(o):void r(new Error("Error decoding file data: "+e))},function(e){r(e)})},t.onerror=function(){r("Audio failed to load.")},t.send()})};e.loadAudioBuffer=t;var a=function(e){return new Promise(function(n,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&200===o.status&&n(JSON.parse(o.responseText))},o.open("GET",e),o.send()})};e.loadJSON=a;var i=function(e){return new Promise(function(n,r){var o=document.createElement("script");o.onload=o.onreadystatechange=function(){o.readyState&&"compconste"!=o.readyState||n(o)},o.src=e,document.getElementsByTagName("head")[0].appendChild(o)})};e.loadScript=i;var u={jpg:n,png:n,bmp:n,mp3:r,ogg:r,wav:r,json:a,js:i},v=function(e){var n=e.match(/(?:\.([^.]+))?$/)[1],r=u[n];return void 0!==r?r(e):Promise.reject(Error('Unknown extension "'+n+'".'))};e.load=v;var s=function(e){var n,r,o,t,a=[];t=Object.keys(e),n=GET_ITER$0(t),o=0===n,r=o?t.length:void 0;for(var i;o?n<r:!(r=n.next()).done;)i=o?t[n++]:r.value,a.push([i,e[i]]);return n=r=o=t=void 0,a},c=function(e){var n={};return Promise.all(s(e).map(function(e){var r=e[0],e=e[1];return v(e).then(function(e){n[r]=e})})).then(function(){return n})};e.loadAll=c}(),function(){var e=nova.utils.misc,n=function(e){var n=arguments[1];void 0===n&&(n=0);var r={};return r.progress=function(r,o){for(n+=r;n>=e;)n-=e,o()},r};e.interval=n;var r=function(e,n){var r=localStorage.getItem(e);return null!==r?r:n};e.loadData=r;var o=function(e,n){return localStorage.setItem(e,n)};e.saveData=o}();